# ayespex

This repo is used to demo different ways of scanning `.aspx` files. `aspx` files are markup files that are generated by .NET programs which sport an HTML-like syntax and are generally used for generating web pages. As such, they can contain inline JS via `<script>` tags. Like all other JS code, it may contain vulnerabilities.

## disclaimer

**Use at your own risk. No troubleshooting support for the scanning process and results will be given.**

[CodeQL does not currently support](https://codeql.github.com/docs/codeql-overview/supported-languages-and-frameworks/) `aspx` files, so this workaround may produce false positives or false negatives. Furthermore, all example workflows contained in this repository make certain assumptions, and any users of these workflows should review them carefully.

For accurate results and scanning of inline JS inside `.aspx` files, those `.aspx` files should be refactored so they contain no inline JS code. That is, all inline JS code should be removed and stored in their respective `.js/.ts/.whatevers` files.

## modify aspx files and the resulting SARIF

One method of scanning `aspx` files with the CodeQL action is to add some additional steps to the default workflow. See [custom-codeql-action-aspx.yml](./.github/workflows/custom-codeql-action-aspx.yml) for the full workflow.

1. [Modify all `aspx` files](./.github/workflows/custom-codeql-action-aspx.yml#L43) to have a `.html` extension 
2. Perform the typical analysis, but ensure the [JS SARIF](./.github/workflows/custom-codeql-action-aspx.yml#L59) doesn't upload automatically
3. [Modify the resulting SARIF](./.github/workflows/custom-codeql-action-aspx.yml#L72) by stripping the `.html` extension
4. [Manually upload the now modified SARIF file](./.github/workflows/custom-codeql-action-aspx.yml#L80)

If done properly, the results will display under the code scanning alerts section of security overview while pointing to the correct file and correct line of code.

## use the CodeQL CLI

The other method is to eschew using the CodeQL actions and to use the CodeQL CLI instead. Again, since CodeQL doesn't scan `aspx` files, CodeQL will need to be manipulated into scanning these files. This can be done with custom [CodeQL CLI commands](https://codeql.github.com/docs/codeql-cli/manual/). If using this method, it's recommended to give this action its own workflow file to avoid confusion or other scanning conflicts.

See the [custom-codeql-cli-aspx.yml](./.github/workflows/custom-codeql-cli-aspx.yml#L32) workflow for a full example.

1. Initialize the CodeQL database
2. Configure the trace command 
3. Tell the CodeQL extractor to target `.aspx` files
4. Finalize the database
5. Analyze the database
6. Upload the results

The CodeQL CLI has an [upload command](https://codeql.github.com/docs/codeql-cli/manual/github-upload-results/); however, it may be easier to use the `github/codeql-action/upload-sarif` action. If you opt to use the CLI command, you must pass in a personal access token (PAT) with the requisite permissions. To avoid overwriting results of a previous scan, ensure you set a unique SARIF category.